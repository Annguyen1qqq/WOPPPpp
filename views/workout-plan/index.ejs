<%- include('../partials/header') %>

<div class="workout-plan-container">
    <h2>Weekly Workout Plan</h2>
    
    <div class="days-grid">
        <% const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'] %>
        
        <% days.forEach(day => { %>
            <div class="day-card">
                <h3><%= day.charAt(0).toUpperCase() + day.slice(1) %></h3>
                
                <div class="plans-list">
                    <% if (workoutPlan[day].plans.length > 0) { %>
                        <% workoutPlan[day].plans.forEach(plan => { %>
                            <div class="plan-card">
                                <h4><%= plan.name %></h4>
                                <p><%= plan.description %></p>
                                <p><strong>Duration:</strong> <%= plan.duration %> minutes</p>
                                <button onclick="deletePlan('<%= day %>', '<%= plan._id %>')" class="delete-btn">Delete</button>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="no-plans">No workouts planned</p>
                    <% } %>
                </div>
                
                <button onclick="showAddPlanForm('<%= day %>')" class="add-btn">Add Workout</button>
            </div>
        <% }) %>
    </div>
</div>

<!-- Add Plan Modal -->
<div id="addPlanModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Add New Workout</h3>
        <form id="addPlanForm" action="" method="POST">
            <div class="form-group">
                <label>Name:</label>
                <input type="text" name="name" required>
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea name="description"></textarea>
            </div>
            <div class="form-group">
                <label>Duration (minutes):</label>
                <input type="number" name="duration" required min="1">
            </div>
            <button type="submit" class="btn-primary">Add Workout</button>
        </form>
    </div>
</div>

<script>
const modal = document.getElementById('addPlanModal');
const form = document.getElementById('addPlanForm');
const closeBtn = document.getElementsByClassName('close')[0];

function showAddPlanForm(day) {
    modal.style.display = 'block';
    form.action = `/workout-plans/${day}`;
}

closeBtn.onclick = function() {
    modal.style.display = 'none';
}

window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}

async function deletePlan(day, planId) {
    if (confirm('Are you sure you want to delete this workout?')) {
        try {
            const response = await fetch(`/workout-plans/${day}/${planId}`, {
                method: 'DELETE'
            });
            const data = await response.json();
            if (data.success) {
                location.reload();
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }
}
</script>

<%- include('../partials/footer') %> 